➜  ~ kubectl get deployments -n kong-datamigration
NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
kong-datamigration-kong   2/2     2            2           73d
➜  ~ kubectl get deployment kong-datamigration-kong -n kong-datamigration -o yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "70"
    meta.helm.sh/release-name: kong-datamigration
    meta.helm.sh/release-namespace: kong-datamigration
  creationTimestamp: "2023-10-27T14:54:45Z"
  generation: 74
  labels:
    app.kubernetes.io/component: app
    app.kubernetes.io/instance: kong-datamigration
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: kong
    app.kubernetes.io/version: "3.3"
    helm.sh/chart: kong-2.22.0
    k8slens-edit-resource-version: v1
  name: kong-datamigration-kong
  namespace: kong-datamigration
  resourceVersion: "668952546"
  uid: 94a7ec75-d14a-4c1c-9c37-ade9e9198dc2
spec:
  progressDeadlineSeconds: 600
  replicas: 2
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: app
      app.kubernetes.io/instance: kong-datamigration
      app.kubernetes.io/name: kong
  strategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 0%
    type: RollingUpdate
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/restartedAt: "2024-01-08T17:21:39Z"
        kuma.io/gateway: enabled
        kuma.io/service-account-token-volume: kong-datamigration-kong-token
        traffic.sidecar.istio.io/includeInboundPorts: ""
      creationTimestamp: null
      labels:
        app: kong-datamigration-kong
        app.kubernetes.io/component: app
        app.kubernetes.io/instance: kong-datamigration
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: kong
        app.kubernetes.io/version: "3.3"
        helm.sh/chart: kong-2.22.0
        version: "3.3"
    spec:
      automountServiceAccountToken: false
      containers:
      - env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: CONTROLLER_ELECTION_ID
          value: kong-ingress-controller-leader-kong-datamigration
        - name: CONTROLLER_INGRESS_CLASS
          value: kong-datamigration
        - name: CONTROLLER_KONG_ADMIN_TLS_SKIP_VERIFY
          value: "true"
        - name: CONTROLLER_KONG_ADMIN_URL
          value: https://localhost:8444
        - name: CONTROLLER_PUBLISH_SERVICE
          value: kong-datamigration/kong-datamigration-kong-proxy
        image: kong/kubernetes-ingress-controller:2.12
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /healthz
            port: 10254
            scheme: HTTP
          initialDelaySeconds: 30
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 20
        name: ingress-controller
        ports:
        - containerPort: 10255
          name: cmetrics
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /readyz
            port: 10254
            scheme: HTTP
          initialDelaySeconds: 30
          periodSeconds: 20
          successThreshold: 1
          timeoutSeconds: 20
        resources:
          limits:
            cpu: 500m
            memory: 1Gi
          requests:
            cpu: 200m
            memory: 600Mi
        securityContext:
          readOnlyRootFilesystem: true
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kong-datamigration-kong-token
          readOnly: true
      - env:
        - name: DT_NGINX_FORCE_RUNTIME_INSTRUMENTATION
          value: "on"
        - name: KONG_ADMIN_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PG_HOST
          value: kong-datamigration-postgresql
        - name: KONG_PG_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: kong-datamigration-postgresql
        - name: KONG_PG_PORT
          value: "5432"
        - name: KONG_ADMIN_API_URI
          value: http://kongadmin.dev2.pickles.com.au
        - name: KONG_ADMIN_ERROR_LOG
          value: /dev/stderr
        - name: KONG_ADMIN_GUI_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_ADMIN_GUI_API_URL
          value: https://kongadmin.dev2.pickles.com.au
        - name: KONG_ADMIN_GUI_ERROR_LOG
          value: /dev/stderr
        - name: KONG_ADMIN_GUI_HOST
          value: kongmanager.dev2.pickles.com.au
        - name: KONG_ADMIN_GUI_LISTEN
          value: 0.0.0.0:8445 http2 ssl
        - name: KONG_ADMIN_GUI_PROTOCOL
          value: https
        - name: KONG_ADMIN_GUI_URL
          value: https://kongmanager.dev2.pickles.com.au
        - name: KONG_ADMIN_LISTEN
          value: 0.0.0.0:8444 http2 ssl
        - name: KONG_CLUSTER_LISTEN
          value: "off"
        - name: KONG_CLUSTER_TELEMETRY_LISTEN
          value: "off"
        - name: KONG_D365FOSTORAGE1
          valueFrom:
            secretKeyRef:
              key: d365fostorage1
              name: pickles-picklesauctions-kong-sas-token
        - name: KONG_DATABASE
          value: "off"
        - name: KONG_KIC
          value: "on"
        - name: KONG_LICENSE_DATA
          valueFrom:
            secretKeyRef:
              key: license
              name: kong-enterprise-license
        - name: KONG_LUA_PACKAGE_PATH
          value: /opt/?.lua;/opt/?/init.lua;;
        - name: KONG_NGINX_WORKER_PROCESSES
          value: "2"
        - name: KONG_PLUGINS
          value: bundled
        - name: KONG_PORTAL
          value: "on"
        - name: KONG_PORTAL_API_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PORTAL_API_ERROR_LOG
          value: /dev/stderr
        - name: KONG_PORTAL_API_LISTEN
          value: 0.0.0.0:8447 http2 ssl
        - name: KONG_PORTAL_API_URL
          value: https://kongportal.dev2.pickles.com.au/api
        - name: KONG_PORTAL_GUI_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PORTAL_GUI_ERROR_LOG
          value: /dev/stderr
        - name: KONG_PORTAL_GUI_HOST
          value: kongportal.dev2.pickles.com.au
        - name: KONG_PORTAL_GUI_LISTEN
          value: 0.0.0.0:8446 http2 ssl
        - name: KONG_PORTAL_GUI_PROTOCOL
          value: https
        - name: KONG_PORTAL_GUI_URL
          value: https://kongportal.dev2.pickles.com.au
        - name: KONG_PORT_MAPS
          value: 80:8000, 443:8443
        - name: KONG_PREFIX
          value: /kong_prefix/
        - name: KONG_PROXY_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PROXY_ERROR_LOG
          value: /dev/stderr
        - name: KONG_PROXY_LISTEN
          value: 0.0.0.0:8000, 0.0.0.0:8443 http2 ssl
        - name: KONG_PROXY_STREAM_ACCESS_LOG
          value: /dev/stdout basic
        - name: KONG_PROXY_STREAM_ERROR_LOG
          value: /dev/stderr
        - name: KONG_ROUTER_FLAVOR
          value: traditional
        - name: KONG_SMTP_MOCK
          value: "on"
        - name: KONG_STATUS_ACCESS_LOG
          value: "off"
        - name: KONG_STATUS_ERROR_LOG
          value: /dev/stderr
        - name: KONG_STATUS_LISTEN
          value: 0.0.0.0:8100
        - name: KONG_STREAM_LISTEN
          value: "off"
        - name: KONG_NGINX_DAEMON
          value: "off"
        image: dtapickles.azurecr.io/devops/kong/kong-proxy-go-plugins:3.4.1.1.279639
        imagePullPolicy: IfNotPresent
        lifecycle:
          preStop:
            exec:
              command:
              - kong
              - quit
              - --wait=15
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /status
            port: status
            scheme: HTTP
          initialDelaySeconds: 60
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        name: proxy
        ports:
        - containerPort: 8444
          name: admin-tls
          protocol: TCP
        - containerPort: 8000
          name: proxy
          protocol: TCP
        - containerPort: 8443
          name: proxy-tls
          protocol: TCP
        - containerPort: 8100
          name: status
          protocol: TCP
        - containerPort: 8445
          name: manager-tls
          protocol: TCP
        - containerPort: 8446
          name: portal-tls
          protocol: TCP
        - containerPort: 8447
          name: portalapi-tls
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /status/ready
            port: status
            scheme: HTTP
          initialDelaySeconds: 60
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: "1"
            memory: 1536Mi
          requests:
            cpu: 200m
            memory: 600Mi
        securityContext:
          readOnlyRootFilesystem: true
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /kong_prefix/
          name: kong-datamigration-kong-prefix-dir
        - mountPath: /tmp
          name: kong-datamigration-kong-tmp
      dnsPolicy: ClusterFirst
      imagePullSecrets:
      - name: dtapickles
      initContainers:
      - command:
        - rm
        - -vrf
        - $KONG_PREFIX/pids
        env:
        - name: DT_NGINX_FORCE_RUNTIME_INSTRUMENTATION
          value: "on"
        - name: KONG_ADMIN_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PG_HOST
          value: kong-datamigration-postgresql
        - name: KONG_PG_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: kong-datamigration-postgresql
        - name: KONG_PG_PORT
          value: "5432"
        - name: KONG_ADMIN_API_URI
          value: http://kongadmin.dev2.pickles.com.au
        - name: KONG_ADMIN_ERROR_LOG
          value: /dev/stderr
        - name: KONG_ADMIN_GUI_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_ADMIN_GUI_API_URL
          value: https://kongadmin.dev2.pickles.com.au
        - name: KONG_ADMIN_GUI_ERROR_LOG
          value: /dev/stderr
        - name: KONG_ADMIN_GUI_HOST
          value: kongmanager.dev2.pickles.com.au
        - name: KONG_ADMIN_GUI_LISTEN
          value: 0.0.0.0:8445 http2 ssl
        - name: KONG_ADMIN_GUI_PROTOCOL
          value: https
        - name: KONG_ADMIN_GUI_URL
          value: https://kongmanager.dev2.pickles.com.au
        - name: KONG_ADMIN_LISTEN
          value: 0.0.0.0:8444 http2 ssl
        - name: KONG_CLUSTER_LISTEN
          value: "off"
        - name: KONG_CLUSTER_TELEMETRY_LISTEN
          value: "off"
        - name: KONG_D365FOSTORAGE1
          valueFrom:
            secretKeyRef:
              key: d365fostorage1
              name: pickles-picklesauctions-kong-sas-token
        - name: KONG_DATABASE
          value: "off"
        - name: KONG_KIC
          value: "on"
        - name: KONG_LICENSE_DATA
          valueFrom:
            secretKeyRef:
              key: license
              name: kong-enterprise-license
        - name: KONG_LUA_PACKAGE_PATH
          value: /opt/?.lua;/opt/?/init.lua;;
        - name: KONG_NGINX_WORKER_PROCESSES
          value: "2"
        - name: KONG_PLUGINS
          value: bundled
        - name: KONG_PORTAL
          value: "on"
        - name: KONG_PORTAL_API_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PORTAL_API_ERROR_LOG
          value: /dev/stderr
        - name: KONG_PORTAL_API_LISTEN
          value: 0.0.0.0:8447 http2 ssl
        - name: KONG_PORTAL_API_URL
          value: https://kongportal.dev2.pickles.com.au/api
        - name: KONG_PORTAL_GUI_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PORTAL_GUI_ERROR_LOG
          value: /dev/stderr
        - name: KONG_PORTAL_GUI_HOST
          value: kongportal.dev2.pickles.com.au
        - name: KONG_PORTAL_GUI_LISTEN
          value: 0.0.0.0:8446 http2 ssl
        - name: KONG_PORTAL_GUI_PROTOCOL
          value: https
        - name: KONG_PORTAL_GUI_URL
          value: https://kongportal.dev2.pickles.com.au
        - name: KONG_PORT_MAPS
          value: 80:8000, 443:8443
        - name: KONG_PREFIX
          value: /kong_prefix/
        - name: KONG_PROXY_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PROXY_ERROR_LOG
          value: /dev/stderr
        - name: KONG_PROXY_LISTEN
          value: 0.0.0.0:8000, 0.0.0.0:8443 http2 ssl
        - name: KONG_PROXY_STREAM_ACCESS_LOG
          value: /dev/stdout basic
        - name: KONG_PROXY_STREAM_ERROR_LOG
          value: /dev/stderr
        - name: KONG_ROUTER_FLAVOR
          value: traditional
        - name: KONG_SMTP_MOCK
          value: "on"
        - name: KONG_STATUS_ACCESS_LOG
          value: "off"
        - name: KONG_STATUS_ERROR_LOG
          value: /dev/stderr
        - name: KONG_STATUS_LISTEN
          value: 0.0.0.0:8100
        - name: KONG_STREAM_LISTEN
          value: "off"
        image: dtapickles.azurecr.io/devops/kong/kong-proxy-go-plugins:3.4.1.1.279639
        imagePullPolicy: IfNotPresent
        name: clear-stale-pid
        resources:
          limits:
            cpu: "1"
            memory: 1536Mi
          requests:
            cpu: 200m
            memory: 600Mi
        securityContext:
          readOnlyRootFilesystem: true
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /kong_prefix/
          name: kong-datamigration-kong-prefix-dir
        - mountPath: /tmp
          name: kong-datamigration-kong-tmp
      - args:
        - /bin/bash
        - -c
        - export KONG_NGINX_DAEMON=on KONG_PREFIX=`mktemp -d` KONG_KEYRING_ENABLED=off;
          until kong start; do echo 'waiting for db'; sleep 1; done; kong stop
        env:
        - name: DT_NGINX_FORCE_RUNTIME_INSTRUMENTATION
          value: "on"
        - name: KONG_ADMIN_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_ADMIN_API_URI
          value: http://api-pas-data-migration.dev2.pickles.com.au/admin
        - name: KONG_ADMIN_ERROR_LOG
          value: /dev/stderr
        - name: KONG_ADMIN_GUI_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_ADMIN_GUI_API_URL
          value: http://api-pas-data-migration.dev2.pickles.com.au/admin
        - name: KONG_ADMIN_GUI_ERROR_LOG
          value: /dev/stderr
        - name: KONG_ADMIN_GUI_LISTEN
          value: 0.0.0.0:8002, 0.0.0.0:8445 http2 ssl
        - name: KONG_ADMIN_GUI_URL
          value: https://api-pas-data-migration.dev2.pickles.com.au
        - name: KONG_ADMIN_LISTEN
          value: 0.0.0.0:8444 http2 ssl
        - name: KONG_CLUSTER_LISTEN
          value: "off"
        - name: KONG_CLUSTER_TELEMETRY_LISTEN
          value: "off"
        - name: KONG_D365FOSTORAGE1
          valueFrom:
            secretKeyRef:
              key: d365fostorage1
              name: pickles-picklesauctions-kong-sas-token
        - name: KONG_DATABASE
          value: "off"
        - name: KONG_KIC
          value: "on"
        - name: KONG_LICENSE_DATA
          valueFrom:
            secretKeyRef:
              key: license
              name: kong-enterprise-license
        - name: KONG_LUA_PACKAGE_PATH
          value: /opt/?.lua;/opt/?/init.lua;;
        - name: KONG_NGINX_WORKER_PROCESSES
          value: "2"
        - name: KONG_PG_HOST
          value: kong-datamigration-postgresql
        - name: KONG_PG_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: kong-datamigration-postgresql
        - name: KONG_PG_PORT
          value: "5432"
        - name: KONG_PLUGINS
          value: bundled
        - name: KONG_PORTAL_API_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PORTAL_API_ERROR_LOG
          value: /dev/stderr
        - name: KONG_PORTAL_GUI_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PORTAL_GUI_ERROR_LOG
          value: /dev/stderr
        - name: KONG_PORT_MAPS
          value: 80:8000, 443:8443
        - name: KONG_PREFIX
          value: /kong_prefix/
        - name: KONG_PROXY_ACCESS_LOG
          value: /dev/stdout
        - name: KONG_PROXY_ERROR_LOG
          value: /dev/stderr
        - name: KONG_PROXY_LISTEN
          value: 0.0.0.0:8000, 0.0.0.0:8443 http2 ssl
        - name: KONG_PROXY_STREAM_ACCESS_LOG
          value: /dev/stdout basic
        - name: KONG_PROXY_STREAM_ERROR_LOG
          value: /dev/stderr
        - name: KONG_ROUTER_FLAVOR
          value: traditional
        - name: KONG_SMTP_MOCK
          value: "on"
        - name: KONG_STATUS_ACCESS_LOG
          value: "off"
        - name: KONG_STATUS_ERROR_LOG
          value: /dev/stderr
        - name: KONG_STATUS_LISTEN
          value: 0.0.0.0:8100
        - name: KONG_STREAM_LISTEN
          value: "off"
        - name: KONG_VITALS
        image: dtapickles.azurecr.io/devops/kong/kong-proxy-go-plugins:3.4.1.1.279639
        imagePullPolicy: IfNotPresent
        name: wait-for-db
        resources:
          limits:
            cpu: "1"
            memory: 1536Mi
          requests:
            cpu: 200m
            memory: 600Mi
        securityContext:
          readOnlyRootFilesystem: true
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /kong_prefix/
          name: kong-datamigration-kong-prefix-dir
        - mountPath: /tmp
          name: kong-datamigration-kong-tmp
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      serviceAccount: kong-datamigration-kong
      serviceAccountName: kong-datamigration-kong
      terminationGracePeriodSeconds: 30
      volumes:
      - emptyDir:
          sizeLimit: 256Mi
        name: kong-datamigration-kong-prefix-dir
      - emptyDir:
          sizeLimit: 1Gi
        name: kong-datamigration-kong-tmp
      - name: kong-datamigration-kong-token
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
      - configMap:
          defaultMode: 493
          name: kong-datamigration-kong-bash-wait-for-postgres
        name: kong-datamigration-kong-bash-wait-for-postgres
status:
  availableReplicas: 2
  conditions:
  - lastTransitionTime: "2023-12-18T10:34:25Z"
    lastUpdateTime: "2023-12-18T10:34:25Z"
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: "True"
    type: Available
  - lastTransitionTime: "2024-01-07T16:15:51Z"
    lastUpdateTime: "2024-01-08T17:40:07Z"
    message: ReplicaSet "kong-datamigration-kong-59b77f64b4" has successfully progressed.
    reason: NewReplicaSetAvailable
    status: "True"
    type: Progressing
  observedGeneration: 74
  readyReplicas: 2
  replicas: 2
  updatedReplicas: 2